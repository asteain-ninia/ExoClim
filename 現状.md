# 現状 (課題整理)

## 範囲と前提
- 調査対象: フロントエンド/シミュレーション実装/ドキュメント一部
- 動作確認: 手動で実施

## バグ
現状追跡なし

## 設計/仕様不備
- UIで操作できるパラメータと計算実装の乖離が大きく、変更が結果に反映されない箇所が多数
  - 参照: `components/Controls.tsx`, `services/physics/*.ts`, `services/climateEngine.ts`

## 未使用/死蔵パラメータ (効果なし)
- 風帯: `windDoldrumsWidthDeg`, `windTradePeakWidthDeg` は計算に未使用
  - 参照: `services/physics/windBelts.ts`, `constants.ts`, `types.ts`
- 海流: `oceanShelfAngle`, `oceanDeflectLat`, `oceanSplitOffset`, `oceanCoastDist`, `oceanWestwardAttractionFactor`, `oceanEcPolewardDrift`, `oceanImpactThreshold` は計算に未使用
  - 参照: `services/physics/ocean.ts`, `constants.ts`, `types.ts`
- 惑星/大気: `gravity`, `eccentricity`, `semiMajorAxis`, `solarLuminosity`, `perihelionAngle`, `greenhouseFactor`, `albedoLand`, `albedoOcean`, `albedoIce`, `lapseRate`, `heatCapacityOcean`, `meridionalTransport` は計算に未使用
  - 参照: `services/physics/*.ts`, `constants.ts`, `types.ts`

## 再現性/運用上の懸念
- `Math.random()` が地形生成や海流の一部に使用され、同条件でも結果が再現しない
  - 参照: `services/geography.ts`, `services/physics/ocean.ts`

## パフォーマンス/UX
- 重い計算をメインスレッドで実行するため、解像度が高いとUIフリーズの可能性が高い
  - 参照: `services/climateEngine.ts`, `services/physics/ocean.ts`, `components/OceanDebugView.tsx`

## 技術的負債/不要コード
- 使用されていない App コンポーネントが残存
  - 参照: `components/App.tsx`, `index.tsx`
- Deprecated なデバッグ用モジュールが残存
  - 参照: `services/physics/oceanDebugger.ts`

## 次に着手する内容（優先順・2026-02-14時点）
> この節は「次に実施する計画」の記録。以下はいずれも未着手。

1. Step 4 のプレースホルダ整備（黒画面回避）
   - 目的: `Step 4` クリック時に未定義表示で誤解させない
   - 対象: `App.tsx`, `components/MapVisualizer.tsx`, `components/visualizer/PixelRenderer.ts`
   - 完了条件: `Step 4` 選択時に「未実装であること」が明示され、黒画面にならない

2. Charts/診断に「Thermo/Hydro未実装」を明示
   - 目的: 未計算値を実測値と誤認しない状態にする
   - 対象: `components/Charts.tsx`, `utils/testSuite.ts`, `services/climateEngine.ts`
   - 完了条件: 温度/降水/気候分類が未実装である旨が UI と診断に明示される

3. OceanDebug ガイド整合（K/L相当）
   - 目的: デバッグ表示の解釈ズレを減らす
   - 対象: `components/OceanDebugView.tsx`, `App.tsx`
   - 完了条件: セル境界は `90/cellCount` 推定ではなく `result.wind.cellBoundariesDeg` を優先して表示する

4. 風帯の未使用パラメータ有効化（N相当）
   - 目的: UI で変更した値がモデル挙動に反映される状態にする
   - 対象: `services/physics/windBelts.ts`
   - 対象パラメータ: `windDoldrumsWidthDeg`, `windTradePeakWidthDeg`
   - 完了条件: 両パラメータ変更時に風帯プロファイルが変化する

5. 再現性確保のため seed 導入
   - 目的: 同一条件で同一結果を再生成可能にする
   - 対象: `services/geography.ts`, `services/physics/ocean.ts`, `types.ts`, `constants.ts`
   - 完了条件: 同じ seed + 同じ設定で結果が一致し、seed を変えると結果が変わる
