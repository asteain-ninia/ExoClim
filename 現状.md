# 現状 (課題整理)

## 範囲と前提
- 調査対象: フロントエンド/シミュレーション実装/ドキュメント一部
- 動作確認: 手動で実施

## バグ
現状追跡なし

## 設計/仕様不備
- UIで操作できるパラメータと計算実装の乖離が大きく、変更が結果に反映されない箇所が多数
  - 参照: `components/Controls.tsx`, `services/physics/*.ts`, `services/climateEngine.ts`

- 仕様が明文化されていない
  - どういう状況がゴールなのか定められていない

## 未使用/死蔵パラメータ (効果なし)
- 風帯: `windDoldrumsWidthDeg`, `windTradePeakWidthDeg` は **対応済み**（計算に反映）
  - 参照: `services/physics/windBelts.ts`
- 海流: `oceanShelfAngle`, `oceanDeflectLat`, `oceanSplitOffset`, `oceanCoastDist`, `oceanWestwardAttractionFactor`, `oceanEcPolewardDrift`, `oceanImpactThreshold` は計算に未使用
  - 参照: `services/physics/ocean.ts`, `constants.ts`, `types.ts`
- 惑星/大気: `gravity`, `eccentricity`, `semiMajorAxis`, `solarLuminosity`, `perihelionAngle`, `greenhouseFactor`, `albedoLand`, `albedoOcean`, `albedoIce`, `lapseRate`, `heatCapacityOcean`, `meridionalTransport` は計算に未使用
  - 参照: `services/physics/*.ts`, `constants.ts`, `types.ts`

## 再現性/運用上の懸念
- **対応済み**: `seed` を `SimulationConfig` に導入し、地形生成・海流分岐を seed 駆動に変更
  - 参照: `types.ts`, `constants.ts`, `components/Controls.tsx`, `services/geography.ts`, `services/physics/ocean.ts`
  - 備考: 同じ `seed` + 同じ設定で再現可能

## パフォーマンス/UX
- 重い計算をメインスレッドで実行するため、解像度が高いとUIフリーズの可能性が高い
  - 参照: `services/climateEngine.ts`, `services/physics/ocean.ts`, `components/OceanDebugView.tsx`

## 技術的負債/不要コード
- 使用されていない App コンポーネントが残存
  - 参照: `components/App.tsx`, `index.tsx`
- Deprecated なデバッグ用モジュールが残存
  - 参照: `services/physics/oceanDebugger.ts`

## 今回の実施内容（2026-02-14）
1. Step 4 のプレースホルダ整備（黒画面回避）: **完了**
   - `Step 4` 選択時に未実装メッセージを表示し、黒画面回避
   - 対象: `App.tsx`, `components/MapVisualizer.tsx`, `components/visualizer/PixelRenderer.ts`, `components/visualizer/Legend.tsx`

2. Charts/診断に「Thermo/Hydro未実装」を明示: **完了**
   - 温度/降水/気候分類が未実装である旨を UI と診断で表示
   - 対象: `components/Charts.tsx`, `utils/testSuite.ts`, `services/climateEngine.ts`, `types.ts`

3. OceanDebug ガイド整合（K/L相当）: **完了**
   - セル境界は `result.wind.cellBoundariesDeg` を優先表示（なければ `90/cellCount` にフォールバック）
   - 対象: `components/OceanDebugView.tsx`, `App.tsx`

4. 風帯の未使用パラメータ有効化（N相当）: **完了**
   - `windDoldrumsWidthDeg`, `windTradePeakWidthDeg` を風帯プロファイルに反映
   - 対象: `services/physics/windBelts.ts`

5. 再現性確保のため seed 導入: **完了**
   - `seed` を設定に追加し、地形生成・海流分岐を seed 駆動に変更
   - 対象: `services/geography.ts`, `services/physics/ocean.ts`, `types.ts`, `constants.ts`, `components/Controls.tsx`, `App.tsx`

## 次に着手する内容（更新後）
1. 海流の未使用パラメータ有効化
   - 対象: `services/physics/ocean.ts`, `constants.ts`, `types.ts`
2. 惑星/大気パラメータの熱・水文モデル反映
   - 対象: `services/physics/*.ts`, `services/climateEngine.ts`
3. メインスレッド負荷の軽減（UIフリーズ対策）
   - 対象: `services/climateEngine.ts`, `services/physics/ocean.ts`, `components/OceanDebugView.tsx`
4. 不要コードの整理
   - 対象: `components/App.tsx`, `services/physics/oceanDebugger.ts`
